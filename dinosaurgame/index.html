<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>恐竜ゲーム</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="icon" href="Dinosaur.png" type="image/png">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    /* ===== 選択・長押し完全無効 ===== */
    * {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    html, body {
      margin: 0;
      background: #f0f0f0;
      font-family: 'Press Start 2P', cursive, monospace;
      overflow: hidden;
      touch-action: manipulation;
      overscroll-behavior: none;
    }

    #loader {
      position: fixed;
      inset: 0;
      background: #222;
      color: #0f0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      z-index: 9999;
    }

    .progress-bar {
      width: 80vw;
      max-width: 300px;
      height: 20px;
      border: 2px solid #0f0;
      margin: 15px 0;
      border-radius: 5px;
      overflow: hidden;
    }

    .progress {
      background: #0f0;
      height: 100%;
      width: 0%;
      transition: width 0.2s ease;
    }

    #startBtn {
      background: #0f0;
      border: none;
      padding: 10px 20px;
      font-family: inherit;
      font-size: 16px;
      border-radius: 5px;
      display: none;
      cursor: pointer;
      font-weight: bold;
    }

    #score {
      text-align: center;
      font-size: 18px;
      margin: 10px auto;
      display: none;
    }

    #game {
      width: 90vw;
      max-width: 900px;
      height: 25vw;
      max-height: 250px;
      background: #fff;
      border: 1px solid #333;
      margin: auto;
      position: relative;
      overflow: hidden;
      display: none;
      border-radius: 8px;
    }

    #dino {
      width: 40px;
      height: 40px;
      background: url("Dinosaur.png") no-repeat center / cover;
      position: absolute;
      bottom: 0;
      left: 5vw;
    }

    .cactus {
      position: absolute;
      bottom: 0;
      left: 100%;
      background: url("saboten.png") no-repeat center / cover;
      width: 40px;
      height: 40px;
    }

    #gameOverScreen {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      color: #0f0;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10000;
    }

    #gameOverScreen button {
      margin-top: 15px;
      padding: 10px 15px;
      font-family: inherit;
      font-size: 14px;
      border: none;
      background: #0f0;
      color: #222;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    #bgmToggle {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 12px;
      padding: 6px 10px;
      background: #0f0;
      border: none;
      border-radius: 5px;
      z-index: 10001;
      cursor: pointer;
      font-family: inherit;
    }
  </style>
</head>

<body>

  <div id="loader">
    Loading...
    <div class="progress-bar"><div class="progress"></div></div>
    <button id="startBtn" disabled>ゲームを始める</button>
  </div>

  <div id="score">スコア: 0</div>
  <div id="game">
    <div id="dino"></div>
  </div>

  <div id="gameOverScreen">
    GAME OVER
    <button id="retryBtn">もう一度</button>
  </div>

  <button id="bgmToggle">BGM ON</button>
  <audio id="bgm" src="maou_bgm_8bit28.mp3" loop></audio>

  <script>
    const loader = document.getElementById("loader");
    const progress = document.querySelector(".progress");
    const startBtn = document.getElementById("startBtn");
    const scoreDisplay = document.getElementById("score");
    const game = document.getElementById("game");
    const dino = document.getElementById("dino");
    const gameOverScreen = document.getElementById("gameOverScreen");
    const retryBtn = document.getElementById("retryBtn");
    const bgm = document.getElementById("bgm");
    const bgmToggle = document.getElementById("bgmToggle");

    let load = 0;
    let score = 0;
    let isJumping = false;
    let gameRunning = false;
    let cactusTimer;
    let scoreTimer;
    let bgmOn = true;

    const jumpHeight = 120;

    const loadTimer = setInterval(() => {
      load += Math.random() * 15;
      if (load >= 100) {
        load = 100;
        clearInterval(loadTimer);
        startBtn.disabled = false;
        startBtn.style.display = "block";
      }
      progress.style.width = load + "%";
    }, 100);

    function jump() {
      if (!gameRunning || isJumping) return;
      isJumping = true;
      let y = 0;
      const up = setInterval(() => {
        y += 20;
        dino.style.bottom = y + "px";
        if (y >= jumpHeight) {
          clearInterval(up);
          const down = setInterval(() => {
            y -= 6;
            if (y <= 0) {
              y = 0;
              isJumping = false;
              clearInterval(down);
            }
            dino.style.bottom = y + "px";
          }, 20);
        }
      }, 20);
    }

    function createCactus() {
      if (!gameRunning) return;
      const c = document.createElement("div");
      c.className = "cactus";
      game.appendChild(c);
      let x = game.clientWidth;

      const move = setInterval(() => {
        if (!gameRunning) {
          clearInterval(move);
          c.remove();
          return;
        }
        x -= 6;
        c.style.left = x + "px";

        const dinoBottom = parseInt(getComputedStyle(dino).bottom);
        if (x < 80 && x > 20 && dinoBottom < 35) {
          gameOver();
        }
        if (x < -40) {
          clearInterval(move);
          c.remove();
        }
      }, 20);

      cactusTimer = setTimeout(createCactus, 1200);
    }

    function startGame() {
      loader.style.display = "none";
      scoreDisplay.style.display = "block";
      game.style.display = "block";
      gameOverScreen.style.display = "none";

      score = 0;
      scoreDisplay.textContent = "スコア: 0";
      gameRunning = true;

      scoreTimer = setInterval(() => {
        score += 5;
        scoreDisplay.textContent = "スコア: " + score;
      }, 100);

      createCactus();

      if (bgmOn) {
        bgm.volume = 0.1;
        bgm.play().catch(()=>{});
      }
    }

    function gameOver() {
      gameRunning = false;
      clearInterval(scoreTimer);
      clearTimeout(cactusTimer);
      document.querySelectorAll(".cactus").forEach(c => c.remove());
      gameOverScreen.style.display = "flex";
    }

    startBtn.onclick = startGame;
    retryBtn.onclick = startGame;

    document.addEventListener("keydown", e => {
      if (e.key === " " || e.key === "ArrowUp") {
        e.preventDefault();
        jump();
      }
    });

    /* ===== 画面全体タップでジャンプ ===== */
    document.addEventListener("touchstart", e => {
      if (!gameRunning) return;
      e.preventDefault();
      jump();
    }, { passive: false });

    bgmToggle.onclick = () => {
      bgmOn = !bgmOn;
      bgmToggle.textContent = bgmOn ? "BGM ON" : "BGM OFF";
      bgmOn ? bgm.play() : bgm.pause();
    };
  </script>
</body>
</html>
