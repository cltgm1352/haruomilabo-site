<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>恐竜ゲーム</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="icon" href="Dinosaur.png" type="image/png">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    /* ===== 追加：選択・長押し完全無効 ===== */
    * {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }
    html, body {
      overscroll-behavior: none;
    }

    body {
      margin: 0;
      background: #f0f0f0;
      font-family: 'Press Start 2P', cursive, monospace;
      overflow: hidden;
      touch-action: manipulation;
      user-select: none;
    }

    #loader {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #222;
      color: #0f0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      z-index: 9999;
    }

    .progress-bar {
      width: 80vw;
      max-width: 300px;
      height: 20px;
      border: 2px solid #0f0;
      margin: 15px 0;
      border-radius: 5px;
      overflow: hidden;
    }
    .progress {
      background: #0f0;
      height: 100%;
      width: 0%;
      transition: width 0.2s ease;
    }

    #startBtn {
      background: #0f0;
      border: none;
      padding: 10px 20px;
      font-family: inherit;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 10px;
      color: #222;
      font-weight: bold;
      display: none;
    }

    #score {
      text-align: center;
      font-size: 18px;
      margin: 10px auto 0 auto;
      display: none;
      max-width: 900px;
      width: 90vw;
    }

    #game {
      width: 90vw;
      max-width: 900px;
      height: 25vw;
      max-height: 250px;
      background: #fff;
      border: 1px solid #333;
      margin: 10px auto 20px auto;
      position: relative;
      overflow: hidden;
      display: none;
      border-radius: 8px;
      touch-action: manipulation;
    }

    #dino {
      width: 10vw;
      max-width: 40px;
      height: 10vw;
      max-height: 40px;
      background-image: url("Dinosaur.png");
      background-size: cover;
      position: absolute;
      bottom: 0;
      left: 5vw;
    }

    .cactus {
      position: absolute;
      bottom: 0;
      left: 100%;
      background-image: url("saboten.png");
      background-size: cover;
    }

    @media (max-width: 480px) {
      .cactus {
        width: 7vw;
        max-width: 28px;
        height: 7vw;
        max-height: 28px;
      }
    }
    @media (min-width: 481px) {
      .cactus {
        width: 10vw;
        max-width: 40px;
        height: 10vw;
        max-height: 40px;
      }
    }

    #gameOverScreen {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      color: #0f0;
      font-size: 40px;
      text-align: center;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 2px 2px 0 #080, 4px 4px 0 #040;
      display: none;
      z-index: 10000;
      max-width: 400px;
      width: 90vw;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #gameOverScreen button {
      margin-top: 20px;
      background: #0f0;
      border: none;
      padding: 10px 15px;
      font-family: inherit;
      font-size: 14px;
      color: #222;
      cursor: pointer;
      border-radius: 6px;
      font-weight: bold;
    }

    #postScoreBtn {
      margin-top: 10px;
      background: #0a0;
      border: none;
      padding: 10px 15px;
      font-family: inherit;
      font-size: 14px;
      color: #d0ffd0;
      cursor: pointer;
      border-radius: 6px;
      font-weight: bold;
    }

    #bgmToggle {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 10001;
      padding: 5px 10px;
      font-family: inherit;
      font-size: 12px;
      background: #0f0;
      color: #222;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <div id="loader">
    <div>Loading...</div>
    <div class="progress-bar"><div class="progress"></div></div>
    <button id="startBtn" disabled>ゲームを始める</button>
  </div>

  <div id="score">スコア: 0</div>

  <div id="game">
    <div id="dino"></div>
  </div>

  <div id="gameOverScreen" style="display:none; flex-direction: column;">
    GAME OVER<br />
    <button id="retryBtn">もう一度プレイ</button>
    <button id="postScoreBtn">記録を投稿する</button>
  </div>

  <button id="bgmToggle">BGM ON</button>
  <audio id="bgm" src="maou_bgm_8bit28.mp3" loop></audio>

  <script>
    const loader = document.getElementById("loader");
    const progress = loader.querySelector(".progress");
    const startBtn = document.getElementById("startBtn");
    const scoreDisplay = document.getElementById("score");
    const game = document.getElementById("game");
    const dino = document.getElementById("dino");
    const gameOverScreen = document.getElementById("gameOverScreen");
    const retryBtn = document.getElementById("retryBtn");
    const postScoreBtn = document.getElementById("postScoreBtn");
    const bgm = document.getElementById("bgm");
    const bgmToggle = document.getElementById("bgmToggle");

    let isJumping = false;
    let score = 0;
    let gameRunning = false;
    let scoreInterval;
    let cactusTimeout;
    let baseSpeed;
    let bgmOn = true;

    let loadProgress = 0;
    const loadInterval = setInterval(() => {
      loadProgress += Math.random() * 10;
      if (loadProgress >= 100) {
        loadProgress = 100;
        clearInterval(loadInterval);
        startBtn.disabled = false;
        startBtn.style.display = "block";
      }
      progress.style.width = loadProgress + "%";
    }, 100);

    function jump() {
      if (!gameRunning || isJumping) return;
      isJumping = true;
      let pos = 0;

      const up = setInterval(() => {
        if (pos >= 120) {
          clearInterval(up);
          const down = setInterval(() => {
            if (pos <= 0) {
              clearInterval(down);
              isJumping = false;
              dino.style.bottom = "0px";
            } else {
              pos -= 6;
              dino.style.bottom = pos + "px";
            }
          }, 20);
        } else {
          pos += 20;
          dino.style.bottom = pos + "px";
        }
      }, 20);
    }

    function getCactusSpeed() {
      return baseSpeed * (1 + Math.min(score / 1000, 1));
    }

    function createCactus() {
      if (!gameRunning) return;
      const cactus = document.createElement("div");
      cactus.className = "cactus";
      game.appendChild(cactus);
      let left = game.clientWidth;

      const move = setInterval(() => {
        if (!gameRunning) {
          clearInterval(move);
          cactus.remove();
          return;
        }

        left -= getCactusSpeed();
        cactus.style.left = left + "px";

        const dinoBottom = parseInt(getComputedStyle(dino).bottom);
        if (left < 80 && left > 20 && dinoBottom < 40) {
          gameOver();
        }

        if (left < -50) {
          clearInterval(move);
          cactus.remove();
        }
      }, 20);

      cactusTimeout = setTimeout(createCactus, Math.random() * 900 + 900);
    }

    function startGame() {
      loader.style.display = "none";
      scoreDisplay.style.display = "block";
      game.style.display = "block";
      gameOverScreen.style.display = "none";
      gameRunning = true;
      score = 0;
      scoreDisplay.textContent = "スコア: 0";
      baseSpeed = game.clientWidth / 110;

      scoreInterval = setInterval(() => {
        if (!gameRunning) return;
        score += 5;
        scoreDisplay.textContent = "スコア: " + score;
      }, 100);

      createCactus();

      if (bgmOn) {
        bgm.volume = 0.1;
        bgm.play().catch(()=>{});
      }
    }

    function gameOver() {
      gameRunning = false;
      clearInterval(scoreInterval);
      clearTimeout(cactusTimeout);
      document.querySelectorAll(".cactus").forEach(c => c.remove());
      gameOverScreen.style.display = "flex";
    }

    startBtn.onclick = startGame;
    retryBtn.onclick = startGame;

    postScoreBtn.onclick = () => {
      window.open(
        "https://docs.google.com/forms/d/e/1FAIpQLSd8obO5MvSYJ3T2XPBX9FqIHP9tZ62yJMA7h6zqr8OFCAaVtA/viewform?usp=dialog",
        "_blank"
      );
    };

    document.addEventListener("keydown", e => {
      if (e.key === " " || e.key === "ArrowUp") {
        e.preventDefault();
        jump();
      }
    });

    /* ===== 画面全体タップでジャンプ ===== */
    document.addEventListener("touchstart", e => {
      if (!gameRunning) return;
      e.preventDefault();
      jump();
    }, { passive: false });

    bgmToggle.onclick = () => {
      bgmOn = !bgmOn;
      bgmToggle.textContent = bgmOn ? "BGM ON" : "BGM OFF";
      bgmOn ? bgm.play() : bgm.pause();
    };
  </script>
</body>
</html>
