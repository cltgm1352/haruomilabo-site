<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>恐竜ゲーム</title>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="icon" href="Dinosaur.png" type="image/png">
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

* {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
body {
  font-family: 'Press Start 2P', cursive, monospace;
  background: #f0f0f0;
  overflow: hidden;
  touch-action: manipulation;
}
#loader {
  position: fixed; inset: 0;
  background: #222; color: #0f0;
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  font-size: 18px; z-index: 9999;
}
.progress-bar {
  width: 80vw; max-width: 300px; height: 20px;
  border: 2px solid #0f0; margin: 15px 0; border-radius: 5px; overflow: hidden;
}
.progress {
  background: #0f0; height: 100%; width: 0%; transition: width 0.2s ease;
}
#startBtn {
  background: #0f0; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer;
  border-radius: 5px; margin-top: 10px; color: #222; font-weight: bold; display: none;
}
#score {
  text-align: center; font-size: 18px; margin: 10px auto; display: none; width: 90vw; max-width: 900px;
}
#game {
  width: 90vw; height: 30vw; max-height: 300px; max-width: 900px;
  background: #fff; border: 1px solid #333; margin: 10px auto 20px; position: relative; overflow: hidden;
  display: none; border-radius: 8px;
}
#dino {
  width: 12vw; height: 12vw; max-width: 40px; max-height: 40px;
  background-image: url("Dinosaur.png"); background-size: cover;
  position: absolute; bottom: 0; left: 5vw;
}
.cactus {
  position: absolute; bottom: 0; left: 100%;
  background-image: url("saboten.png"); background-size: cover;
}
@media(max-width:480px){
  #game { width:96vw; height:40vw; }
  #dino { width:14vw; height:14vw; }
  .cactus { width:8vw; height:8vw; }
}
@media(min-width:481px){
  .cactus { width:10vw; height:10vw; max-width:40px; max-height:40px; }
}
#gameOverScreen {
  position: fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#222; color:#0f0; font-size:40px; text-align:center; padding:30px 40px; border-radius:10px;
  box-shadow:2px 2px 0 #080,4px 4px 0 #040; display:none; z-index:10000; max-width:400px; width:90vw;
  flex-direction:column; align-items:center;
}
#gameOverScreen button { margin-top:20px; background:#0f0; border:none; padding:10px 15px; font-size:14px; color:#222; cursor:pointer; border-radius:6px; font-weight:bold; }
#postScoreBtn { margin-top:10px; background:#0a0; color:#d0ffd0; }
#bgmToggle {
  position: fixed; top:10px; right:10px; z-index:10001;
  padding:5px 10px; font-size:12px; background:#0f0; color:#222; border:none; border-radius:5px; cursor:pointer;
}
</style>
</head>
<body>

<div id="loader">
  <div>Loading...</div>
  <div class="progress-bar"><div class="progress"></div></div>
  <button id="startBtn" disabled>ゲームを始める</button>
</div>

<div id="score">スコア: 0</div>
<div id="game"><div id="dino"></div></div>

<div id="gameOverScreen">
  GAME OVER<br>
  <button id="retryBtn">もう一度プレイ</button>
  <button id="postScoreBtn">記録を投稿する</button>
</div>

<button id="bgmToggle">BGM OFF</button>
<audio id="bgm" src="maou_bgm_8bit28.mp3" loop></audio>

<script>
const loader=document.getElementById("loader"),progress=loader.querySelector(".progress"),startBtn=document.getElementById("startBtn");
const scoreDisplay=document.getElementById("score"),game=document.getElementById("game"),dino=document.getElementById("dino");
const gameOverScreen=document.getElementById("gameOverScreen"),retryBtn=document.getElementById("retryBtn"),postScoreBtn=document.getElementById("postScoreBtn");
const bgm=document.getElementById("bgm"),bgmToggle=document.getElementById("bgmToggle");

let isJumping=false,gameRunning=false,score=0,scoreInterval,cactusTimeout,baseSpeed,bgmOn=false;

let load=0;
const loadInterval=setInterval(()=>{
  load+=Math.random()*10;
  if(load>=100){load=100;clearInterval(loadInterval);startBtn.disabled=false;startBtn.style.display="block";}
  progress.style.width=load+"%";
},100);

function jump(){
  if(!gameRunning||isJumping) return;
  isJumping=true;
  let y=0;
  const up=setInterval(()=>{
    if(y>=120){clearInterval(up); const down=setInterval(()=>{
      if(y<=0){y=0;clearInterval(down);isJumping=false;}
      y-=6; dino.style.bottom=y+"px";
    },20);}else{y+=20; dino.style.bottom=y+"px";}
  },20);
}

function getCactusSpeed(){return baseSpeed*(1+Math.min(score/1000,1));}

function createCactus(){
  if(!gameRunning) return;
  const cactus=document.createElement("div"); cactus.className="cactus"; game.appendChild(cactus);
  let x=game.clientWidth;
  const move=setInterval(()=>{
    if(!gameRunning){clearInterval(move); cactus.remove(); return;}
    x-=getCactusSpeed(); cactus.style.left=x+"px";
    const dinoRect=dino.getBoundingClientRect(),cRect=cactus.getBoundingClientRect();
    const hitX=6,hitY=6,dinoFoot=dinoRect.bottom-hitY,cTop=cRect.top+cRect.height*0.4;
    if(dinoRect.right-hitX>cRect.left && dinoRect.left+hitX<cRect.right && dinoFoot>cTop){gameOver();}
    if(x<-60){clearInterval(move); cactus.remove();}
  },20);
  cactusTimeout=setTimeout(createCactus,Math.random()*900+900);
}

function startGame(){
  loader.style.display="none"; scoreDisplay.style.display="block"; game.style.display="block"; gameOverScreen.style.display="none";
  score=0; scoreDisplay.textContent="スコア: 0"; gameRunning=true; baseSpeed=game.clientWidth/110;
  scoreInterval=setInterval(()=>{score+=5; scoreDisplay.textContent="スコア: "+score;},100);
  createCactus();
}

function gameOver(){
  gameRunning=false; clearInterval(scoreInterval); clearTimeout(cactusTimeout);
  document.querySelectorAll(".cactus").forEach(c=>c.remove());
  gameOverScreen.style.display="flex";
}

startBtn.onclick=startGame;
retryBtn.onclick=startGame;
postScoreBtn.onclick=()=>{window.open("https://docs.google.com/forms/d/e/1FAIpQLSd8obO5MvSYJ3T2XPBX9FqIHP9tZ62yJMA7h6zqr8OFCAaVtA/viewform?usp=dialog","_blank");};

document.addEventListener("keydown",e=>{if(e.key===" "||e.key==="ArrowUp"){e.preventDefault(); jump();}});
document.addEventListener("touchstart",e=>{if(!gameRunning)return; e.preventDefault(); jump();},{passive:false});

bgmToggle.onclick=()=>{
  bgmOn=!bgmOn; bgmToggle.textContent=bgmOn?"BGM ON":"BGM OFF"; bgmOn?bgm.play():bgm.pause();
};
</script>
</body>
</html>
